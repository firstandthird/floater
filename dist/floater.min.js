/*!
 * floater - a plugin to make element float on the screen
 * v0.4.0
 * https://github.com/firstandthird/floater
 * copyright First+Third 2014
 * MIT License
*/
!function(a,b){var c=0,d=function(a){this.obj=a};d.prototype.__init=function(a){b.extend(this,this.obj),this.id=c++,this.namespace=".fidel"+this.id,this.obj.defaults=this.obj.defaults||{},b.extend(this,this.obj.defaults,a),b("body").trigger("FidelPreInit",this),this.setElement(this.el||b("<div/>")),this.init&&this.init(),b("body").trigger("FidelPostInit",this)},d.prototype.eventSplitter=/^(\w+)\s*(.*)$/,d.prototype.setElement=function(a){this.el=a,this.getElements(),this.dataElements(),this.delegateEvents(),this.delegateActions()},d.prototype.find=function(a){return this.el.find(a)},d.prototype.proxy=function(a){return b.proxy(a,this)},d.prototype.getElements=function(){if(this.elements)for(var a in this.elements){var b=this.elements[a];this[b]=this.find(a)}},d.prototype.dataElements=function(){var a=this;this.find("[data-element]").each(function(c,d){var e=b(d),f=e.data("element");a[f]=e})},d.prototype.delegateEvents=function(){if(this.events)for(var a in this.events){var b=this.events[a],c=a.match(this.eventSplitter),d=c[1],e=c[2],f=this.proxy(this[b]);""===e?this.el.on(d+this.namespace,f):this[e]&&"function"!=typeof this[e]?this[e].on(d+this.namespace,f):this.el.on(d+this.namespace,e,f)}},d.prototype.delegateActions=function(){var a=this;a.el.on("click"+this.namespace,"[data-action]",function(c){var d=b(this),e=d.attr("data-action");a[e]&&a[e](c,d)})},d.prototype.on=function(a,b){this.el.on(a+this.namespace,b)},d.prototype.one=function(a,b){this.el.one(a+this.namespace,b)},d.prototype.emit=function(a,b,c){var d=c?this.namespace:"";this.el.trigger(a+d,b)},d.prototype.hide=function(){if(this.views)for(var a in this.views)this.views[a].hide();this.el.hide()},d.prototype.show=function(){if(this.views)for(var a in this.views)this.views[a].show();this.el.show()},d.prototype.destroy=function(){this.el.empty(),this.emit("destroy"),this.el.unbind(this.namespace)},d.declare=function(a){var b=function(a,b){this.__init(a,b)};return b.prototype=new d(a),b},d.onPreInit=function(a){b("body").on("FidelPreInit",function(b,c){a.call(c)})},d.onPostInit=function(a){b("body").on("FidelPostInit",function(b,c){a.call(c)})},a.Fidel=d}(window,window.jQuery||window.Zepto),function(a){a.declare=function(b,c){a.fn[b]=function(){var d,e,f=Array.prototype.slice.call(arguments),g=f.shift();return e=this.each(function(){var e=a(this),h=e.data(b);if(!h){var i=Fidel.declare(c),j=a.extend({},g,{el:e});h=new i(j),e.data(b,h)}"string"==typeof g&&(d=h[g].apply(h,f))}),"undefined"!=typeof d?d:e},a.fn[b].defaults=c.defaults||{}},a.Fidel=window.Fidel}(jQuery),function(a){a.declare("floater",{defaults:{topPadding:0,stopPoint:-1,stopElement:null,startPoint:-1,relative:!1,offsetX:0,offsetY:0,stopOffset:0,debug:!1,autoRecalc:!1,floatClass:"floating"},init:function(){this.enabled=!0,this.floating=!1,this.recalcTimeout=null,this.recalc(),a(window).on("scroll",this.proxy(this.onScroll)),this.onScroll()},recalc:function(){if(!this.floating){this.resetStyles={position:this.el.css("position"),top:this.el.css("top"),left:this.el.css("left"),width:this.el.css("width")};var a=this.el.offset();this.topPadding=parseInt(this.topPadding,10),this.startPoint=a.top-this.topPadding,this.height=this.el.outerHeight(!0),this.stopElement&&(this.stopPoint=this.stopElement.offset().top),this.debug&&this.showDebug()}},setStartPoint:function(a){this.startPoint=a,this.debug&&this.showDebug()},setStopPoint:function(a){this.stopPoint=a,this.debug&&this.showDebug()},showDebug:function(){a(".floater-debug").remove();var b=function(b){a("<div/>").css({position:"absolute",height:"1px",width:"100%",background:"red",top:b}).addClass("floater-debug").appendTo("body")};b(this.startPoint),b(this.stopPoint)},createPlaceholder:function(){var b=this.el[0].className||"";return a("<div/>").addClass("floater-placeholder "+b).css({width:this.el.css("width"),height:this.el.css("height"),visibility:"hidden"})},startFloat:function(){if(!this.floating){this.floating=!0;var a=this.el.offset();this.el.prev().hasClass("floater-placeholder")||this.el.before(this.createPlaceholder()),this.el.css({position:"fixed",top:this.topPadding+"px",left:a.left+this.offsetX,width:this.el.css("width")}),this.floatClass&&this.el.addClass(this.floatClass),this.emit("floatStart")}},stopFloat:function(){this.floating&&(this.floating=!1,this.el.prev().remove(),this.el.css({position:"",top:"",left:"",width:""}),this.floatClass&&this.el.removeClass(this.floatClass),this.emit("floatStop"))},freezeFloat:function(a){this.floating&&(this.floating=!1,this.el.css({position:"absolute",top:a,left:"",width:this.el.css("width")}),this.emit("floatStop"))},onScroll:function(){if(this.enabled){this.autoRecalc&&(clearTimeout(this.recalcTimeout),this.recalcTimeout=setTimeout(this.proxy(this.recalc),500));var b=a(window).scrollTop();b>this.startPoint?-1!=this.stopPoint&&b+this.height+this.topPadding>this.stopPoint?this.floating&&this.freezeFloat(this.stopPoint-this.height-this.stopOffset):this.floating||this.startFloat():this.floating&&b<this.startPoint&&this.stopFloat()}},on:function(){this.enabled=!0,this.onScroll()},off:function(){this.stopFloat(),this.enabled=!1}})}(window.jQuery||window.Zepto);